<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Worldly ‚Äì Where Do You Want To Go Next?</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: "Inter", system-ui, sans-serif;
      margin: 0 auto;
      max-width: 1200px;
      padding: 2rem 1.5rem;
      min-height: 100vh;
      -webkit-tap-highlight-color: transparent;
      background: #1a1625;
      color: #eee;
    }

    .header {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    h1 {
      font-family: "Playfair Display", Georgia, serif;
      font-size: 3.25rem;
      font-weight: 700;
      margin: 0 0 0.25rem 0;
      color: #e5c65c;
    }
    .tagline {
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.2em;
      color: rgba(255,255,255,0.85);
      text-transform: uppercase;
      margin: 0 0 1.5rem 0;
    }

    .search-wrap {
      display: flex;
      justify-content: center;
      margin-bottom: 2rem;
    }
    .search-bar {
      display: flex;
      align-items: center;
      width: 100%;
      max-width: 420px;
      height: 48px;
      padding: 0 1rem 0 1.25rem;
      background: rgba(40, 35, 55, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 24px;
    }
    .search-bar input {
      flex: 1;
      background: none;
      border: none;
      color: #eee;
      font-size: 0.95rem;
      outline: none;
    }
    .search-bar input::placeholder {
      color: rgba(255,255,255,0.45);
    }
    .search-bar .icon {
      width: 20px;
      height: 20px;
      margin-left: 0.5rem;
      opacity: 0.6;
    }

    .list {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.25rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    @media (max-width: 900px) {
      .list { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 500px) {
      .list { grid-template-columns: 1fr; }
    }

    .world-card {
      display: block;
      position: relative;
      width: 100%;
      min-width: 0;
      background: #252035;
      border-radius: 16px;
      overflow: hidden;
      text-decoration: none;
      color: #eee;
      cursor: pointer;
      border: 1px solid rgba(148, 163, 184, 0.12);
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }
    .world-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0,0,0,0.4);
    }

    .world-card .thumb-wrap {
      width: 100%;
      height: 280px;
      overflow: hidden;
      background: #1e1a2a;
      position: relative;
    }
    .card-hover-label {
      position: absolute;
      top: 0.75rem;
      left: 0.75rem;
      font-size: 0.75rem;
      color: rgba(255,255,255,0.9);
      opacity: 0;
      transition: opacity 0.25s ease;
      z-index: 2;
    }
    .world-card:hover .card-hover-label {
      opacity: 1;
    }
    .world-card .thumb {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center center;
      display: block;
      transition: transform 0.4s ease;
    }
    .world-card.thumb-top .thumb {
      object-position: top center;
    }
    .world-card:hover .thumb {
      transform: scale(1.05);
    }
    .world-card .thumb.loaded { opacity: 1; }
    .world-card .thumb:not(.loaded) { opacity: 0; }

    .card-title-band {
      padding: 0.9rem 1rem;
      background: rgba(20, 18, 28, 0.95);
    }
    .card-title-band .main {
      font-family: "Playfair Display", Georgia, serif;
      font-size: 1.15rem;
      font-weight: 600;
      display: block;
      color: #fff;
    }
    .card-title-band .sub {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.75);
      margin-top: 0.15rem;
    }

    .card-hover {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      max-height: 65%;
      overflow-y: auto;
      padding: 1.25rem 1rem 1rem;
      background: linear-gradient(to top, rgba(45, 40, 65, 0.98), rgba(35, 30, 50, 0.95));
      transform: translateY(100%);
      transition: transform 0.3s ease;
      pointer-events: none;
    }
    .world-card:hover .card-hover {
      transform: translateY(0);
      pointer-events: auto;
    }
    .card-hover .hover-title {
      font-family: "Playfair Display", Georgia, serif;
      font-size: 1.25rem;
      font-weight: 600;
      color: #fff;
      display: block;
    }
    .card-hover .hover-sub {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.8);
      margin-bottom: 0.65rem;
    }
    .card-hover .hover-desc {
      font-size: 0.8rem;
      line-height: 1.45;
      color: rgba(255,255,255,0.85);
      margin-bottom: 0.75rem;
    }
    .card-hover .hover-meta {
      display: flex;
      gap: 1rem;
      font-size: 0.75rem;
      color: rgba(255,255,255,0.65);
      margin-bottom: 0.9rem;
    }
    .card-hover .explore-btn {
      display: inline-block;
      padding: 0.5rem 1.25rem;
      background: rgba(212, 175, 55, 0.25);
      border: 1px solid rgba(212, 175, 55, 0.5);
      border-radius: 20px;
      color: #d4af37;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      transition: background 0.2s, border-color 0.2s;
    }
    .world-card:hover .explore-btn {
      background: rgba(212, 175, 55, 0.35);
      border-color: #d4af37;
    }

    .empty {
      color: rgba(255,255,255,0.6);
      padding: 2rem;
      text-align: center;
      grid-column: 1 / -1;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Worldly</h1>
    <p class="tagline">Where Do You Want To Go Next?</p>
  </div>
  <div class="search-wrap">
    <div class="search-bar">
      <input type="text" placeholder="Search landmarks, cities, or styles..." id="search" aria-label="Search">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
      </svg>
    </div>
  </div>
  <div id="list" class="list"></div>

  <script>
    const INLINE_WORLDS = [
      { displayName: "Example World", marbleUrl: "https://marble.worldlabs.ai/world/your-world-id" }
    ];

    const listEl = document.getElementById("list");

    function escapeHtml(s) {
      const div = document.createElement("div");
      div.textContent = s;
      return div.innerHTML;
    }

    function splitTitle(name) {
      if (!name || !name.trim()) return { main: "", sub: "" };
      const parts = name.trim().split(/\s+/);
      if (parts.length <= 1) return { main: name, sub: "" };
      if (parts.length === 2) return { main: parts[0], sub: parts[1] };
      const main = parts.slice(0, 2).join(" ");
      const sub = parts.slice(2).join(" ");
      return { main, sub };
    }

    function placeholderThumbUrl(marbleUrl) {
      return "https://picsum.photos/seed/" + escapeHtml(String(marbleUrl).slice(-8)) + "/400/240";
    }

    function parseOgImageFromHtml(html) {
      const match = html.match(/<meta[^>]+property=["']og:image["'][^>]+content=["']([^"']+)["']/i)
        || html.match(/<meta[^>]+content=["']([^"']+)["'][^>]+property=["']og:image["']/i);
      return match ? match[1].trim() : null;
    }

    async function fetchMarbleThumbnail(marbleUrl) {
      try {
        const proxyUrl = "https://corsproxy.io/?" + encodeURIComponent(marbleUrl);
        const res = await fetch(proxyUrl, { method: "GET" });
        if (!res.ok) return null;
        const html = await res.text();
        return parseOgImageFromHtml(html);
      } catch (_) {
        return null;
      }
    }

    function renderWorlds(worlds) {
      listEl.innerHTML = "";
      if (!worlds || worlds.length === 0) {
        listEl.innerHTML = '<p class="empty">No worlds yet. Edit <code>worlds.json</code>.</p>';
        return;
      }
      worlds.forEach((w) => {
        if (!w.marbleUrl) return;
        const titleSub = w.title && w.subtitle
          ? { main: w.title, sub: w.subtitle }
          : splitTitle(w.displayName || "");
        const card = document.createElement("a");
        card.className = "world-card" + (w.thumbnailPosition === "top" ? " thumb-top" : "");
        card.href = w.marbleUrl;

        const thumbSrc = w.thumbnailUrl || placeholderThumbUrl(w.marbleUrl);
        const thumbWrap = document.createElement("div");
        thumbWrap.className = "thumb-wrap";
        const hoverLabel = document.createElement("span");
        hoverLabel.className = "card-hover-label";
        hoverLabel.textContent = w.displayName || titleSub.main + (titleSub.sub ? " " + titleSub.sub : "");
        thumbWrap.appendChild(hoverLabel);
        const img = document.createElement("img");
        img.className = "thumb";
        img.alt = "";
        img.src = thumbSrc;
        img.addEventListener("load", () => img.classList.add("loaded"));
        if (img.complete) img.classList.add("loaded");
        thumbWrap.appendChild(img);
        card.appendChild(thumbWrap);

        const titleBand = document.createElement("div");
        titleBand.className = "card-title-band";
        titleBand.innerHTML = "<span class=\"main\">" + escapeHtml(titleSub.main) + "</span>" +
          (titleSub.sub ? "<span class=\"sub\">" + escapeHtml(titleSub.sub) + "</span>" : "");
        card.appendChild(titleBand);

        const hover = document.createElement("div");
        hover.className = "card-hover";
        hover.innerHTML =
          "<span class=\"hover-title\">" + escapeHtml(titleSub.main) + "</span>" +
          (titleSub.sub ? "<span class=\"hover-sub\">" + escapeHtml(titleSub.sub) + "</span>" : "") +
          "<p class=\"hover-desc\">" + escapeHtml(w.description || "Explore this place in VR.") + "</p>" +
          "<div class=\"hover-meta\">" +
          (w.location ? "<span>üìç " + escapeHtml(w.location) + "</span>" : "") +
          (w.visited ? "<span>üìÖ Visited " + escapeHtml(w.visited) + "</span>" : "") +
          "</div>" +
          "<span class=\"explore-btn\">Explore</span>";
        card.appendChild(hover);

        listEl.appendChild(card);

        if (!w.thumbnailUrl) {
          fetchMarbleThumbnail(w.marbleUrl).then((url) => {
            if (url && img.parentNode) img.src = url;
          });
        }
      });
    }

    const searchEl = document.getElementById("search");
    let allWorlds = [];
    fetch("worlds.json")
      .then((r) => (r.ok ? r.json() : Promise.reject()))
      .then((data) => {
        allWorlds = data && data.worlds && data.worlds.length ? data.worlds : INLINE_WORLDS;
        renderWorlds(allWorlds);
      })
      .catch(() => {
        allWorlds = INLINE_WORLDS;
        renderWorlds(allWorlds);
      });

    searchEl.addEventListener("input", () => {
      const q = (searchEl.value || "").trim().toLowerCase();
      if (!q) {
        renderWorlds(allWorlds);
        return;
      }
      const filtered = allWorlds.filter((w) => {
        const name = (w.displayName || w.title || "").toLowerCase();
        const sub = (w.subtitle || "").toLowerCase();
        const desc = (w.description || "").toLowerCase();
        return name.includes(q) || sub.includes(q) || desc.includes(q);
      });
      renderWorlds(filtered);
    });
  </script>
</body>
</html>
